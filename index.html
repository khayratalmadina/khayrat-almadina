<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta name="google-site-verification" content="SXH5ilLpVenffQCJ-U-UHDuTIPLgLRZiEuY8tJVxbII" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>khayrat almadina - واجهة رأسية</title>
  <!-- Bootstrap 5 مع RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- خط Cairo -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* الوضع الليلي */
    body.dark-mode .product-card {
      background: #34495e;
      color: #ecf0f1;
    }
    body.dark-mode .product-card .product-title,
    body.dark-mode .product-card .product-details,
    body.dark-mode .product-card .product-price {
      color: #ecf0f1;
    }
    /* المتغيرات الأساسية */
    :root {
      --primary-color: #2980b9;
      --secondary-color: #27ae60;
      --accent-color: #f39c12;
      --background: #f0f8ff;
      --sidebar-bg: #fff;
      --modal-bg: rgba(0,0,0,0.7);
    }
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--background);
      margin: 0;
      padding: 0;
      transition: background 0.3s ease;
    }
    body.dark-mode {
      background: #2c3e50;
      color: #ecf0f1;
    }
    body.dark-mode .sidebar {
      background: #34495e;
    }
    body.dark-mode .sidebar .menu-item svg,
    body.dark-mode .sidebar .menu-item span.label {
      fill: #ecf0f1;
      color: #ecf0f1;
    }
    body.dark-mode .modal-content {
      background: #2c3e50;
      color: #ecf0f1;
    }
    body.dark-mode .pharmacy-form input,
    body.dark-mode .pharmacy-form textarea {
      background: #34495e;
      color: #ecf0f1;
      border: 1px solid #555;
    }
    /* الشريط الجانبي */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 70px;
      height: 100%;
      background: var(--sidebar-bg);
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      transition: width 0.3s ease;
      z-index: 1200;
    }
    .sidebar.expanded {
      width: 200px;
    }
    .sidebar .menu-item {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 1rem 0;
      cursor: pointer;
      position: relative;
      transition: background 0.3s;
    }
    .sidebar .menu-item:hover {
      background: rgba(0,0,0,0.05);
    }
    .sidebar.expanded .menu-item {
      justify-content: flex-start;
      padding-left: 1rem;
    }
    .sidebar .menu-item span.label {
      display: none;
      margin-left: 0.5rem;
      font-size: 1rem;
      color: var(--primary-color);
    }
    .sidebar.expanded .menu-item span.label {
      display: inline;
    }
    .sidebar .menu-item svg {
      width: 24px;
      height: 24px;
      fill: var(--primary-color);
    }
    /* منطقة المحتوى */
    .main-content {
      margin-left: 80px;
      padding: 1rem;
      position: relative;
    }
    header {
      padding: 1rem;
      border-bottom: 1px solid #fffffff1;
    }
    header h1 {
      font-size: 2rem;
      margin: 0;
    }
    header p {
      font-size: 1rem;
      color: var(--accent-color);
      margin: 0.5rem 0 0;
    }
    /* عرض عدد الأعضاء مع أيقونة */
    .member-count {
      background: rgba(217, 223, 221, 0.961);
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    body.dark-mode .member-count {
      background: rgba(255,255,255,0.1);
    }
    /* شريط البحث الذي يتمدد عند النقر */
    #search-bar-container {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      overflow: hidden;
      transition: width 0.5s ease;
      z-index: 1500;
    }
    #search-bar-container.active {
      width: 80%;
      max-width: 600px;
    }
    #search-bar {
      width: 100%;
      padding: 0.5rem 1rem;
      font-size: 1.2rem;
      border: 2px solid var(--primary-color);
      border-radius: 25px;
      outline: none;
    }
    /* شبكة المنتجات */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }
    .product-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .product-card:hover {
      transform: translateY(-3px);
    }
    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      cursor: pointer;
    }
    .product-card .card-body {
      padding: 0.5rem 0.8rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .product-card .product-title {
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 0.3rem;
      position: relative;
    }
    .product-card .product-details {
      font-size: 0.8rem;
      color: #7f8c8d;
      margin-bottom: 0.5rem;
    }
    .product-card .product-price {
      font-size: 0.9rem;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
    /* شارة أفضل المبيعات */
    .best-seller-badge {
      position: absolute;
      top: 0;
      left: 0;
      background: var(--accent-color);
      color: #fff;
      padding: 5px 10px;
      font-size: 0.8rem;
      font-weight: bold;
      border-bottom-right-radius: 10px;
      z-index: 5;
    }
    /* يمكنك أيضاً تمييز البطاقة بإضافة حد */
    .best-seller {
      border: 2px solid var(--accent-color);
    }
    /* أزرار تحديد الكمية */
    .quantity-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      margin-top: auto;
      position: relative;
    }
    .quantity-controls button {
      border: none;
      background: var(--secondary-color);
      color: #fff;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
      position: relative;
      overflow: visible;
    }
    .quantity-controls button:hover {
      background: #1e8449;
    }
    .quantity-controls span {
      font-size: 1rem;
      width: 20px;
      text-align: center;
    }
    /* مؤشرات الحركة */
    .indicator {
      pointer-events: none;
      font-size: 2rem;
      font-weight: bold;
      opacity: 1;
      position: absolute;
      z-index: 10;
    }
    .plus-indicator {
      color: green;
      animation: plusAnim 0.5s ease forwards;
    }
    .minus-indicator {
      color: red;
      animation: minusAnim 0.5s ease forwards;
    }
    @keyframes plusAnim {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-30px) scale(1.5); }
    }
    @keyframes minusAnim {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(30px) scale(1.5); }
    }
    /* تأثير الاهتزاز */
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(-2px, 0); }
      50% { transform: translate(2px, 0); }
      75% { transform: translate(-2px, 0); }
      100% { transform: translate(0, 0); }
    }
    .shake {
      animation: shake 0.3s ease;
    }
    /* زر حفظ المنتج */
    .save-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .save-btn svg {
      width: 24px;
      height: 24px;
      fill: #ccc;
      transition: fill 0.3s;
    }
    .save-btn.active svg {
      fill: red;
    }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .animate-heart {
      animation: heartbeat 0.5s ease;
    }
    /* أنميشن لزر البحث */
    @keyframes searchBounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .animate-search {
      animation: searchBounce 0.5s ease;
    }
    /* زر السلة العائم - تغيير الأيقونة */
    .fab-cart {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: var(--primary-color);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.5rem;
      z-index: 1300;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.3s;
    }
    .fab-cart:hover {
      transform: scale(1.1);
    }
    /* أنماط النوافذ المنبثقة */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
      z-index: 1400;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal-content {
      background: #fff;
      border-radius: 10px;
      padding: 1.5rem;
      width: 90%;
      max-width: 500px;
      position: relative;
      animation: slideIn 0.3s ease;
      font-size: 1rem;
      color: #333;
    }
    body.dark-mode .modal-content {
      background: #2c3e50;
      color: #ecf0f1;
    }
    @keyframes slideIn {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      border: none;
      background: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
    /* ملخص سلة الشراء */
    .cart-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.3rem;
      cursor: pointer;
    }
    .cart-total {
      text-align: right;
      font-weight: bold;
      margin-top: 1rem;
    }
    .btn-purchase {
      width: 100%;
      margin-top: 1rem;
    }
    /* نموذج معلومات الصيدلية */
    .pharmacy-form input,
    .pharmacy-form textarea {
      margin-bottom: 0.8rem;
      font-size: 1rem;
      padding: 0.5rem;
    }
    /* تحسين النصوص داخل النوافذ */
    .modal-header h4,
    .modal-header h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .modal-body,
    #favorites-content,
    #most-sold-content {
      font-size: 1rem;
    }
    /* أنميشن لتبديل أيقونة الوضع */
    .toggle-animation {
      animation: iconRotate 0.5s ease;
    }
    @keyframes iconRotate {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }
    /* أنميشن زر الرئيسية */
    .animate-home {
      animation: homeBounce 0.5s ease;
    }
    @keyframes homeBounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    /* نافذة تكبير صورة المنتج */
    .image-modal-content {
      width: 35vw;
      height: 35vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      border-radius: 10px;
      position: relative;
    }
    .image-modal-content img {
      max-width: 100%;
      max-height: 100%;
    }
    /* تمييز بطاقة المنتج عند التوجيه */
    .highlight {
      animation: highlightAnim 1s ease;
    }
    @keyframes highlightAnim {
      0% { box-shadow: 0 0 10px yellow; }
      100% { box-shadow: none; }
    }
  </style>
</head>
<body>
  <!-- الشريط الجانبي مع أزرار البحث والأكثر مبيعا والمحفوظات -->
  <div class="sidebar" id="sidebar">
    <!-- زر الهامبرجر -->
    <div class="menu-item" id="toggle-sidebar" title="القائمة">
      <svg viewBox="0 0 24 24">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="label">القائمة</span>
    </div>
    <!-- زر الرئيسية -->
    <div class="menu-item" id="menu-home" title="الرئيسية">
      <svg viewBox="0 0 24 24">
        <path d="M12 3l9 8-3 3-6 6-6-6-3-3 9-8z"/>
      </svg>
      <span class="label">الرئيسية</span>
    </div>
    <!-- زر البحث -->
    <div class="menu-item" id="menu-search" title="بحث">
      <svg viewBox="0 0 24 24">
        <path d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" fill="none"/>
      </svg>
      <span class="label">بحث</span>
    </div>
    <!-- زر الأكثر مبيعا -->
    <div class="menu-item" id="menu-most-sold" title="الأكثر مبيعا">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" stroke="var(--primary-color)" stroke-width="2" fill="none"/>
      </svg>
      <span class="label">الأكثر مبيعا</span>
    </div>
    <!-- زر المحفوظات -->
    <div class="menu-item" id="menu-favorites" title="المحفوظات">
      <svg viewBox="0 0 24 24" data-icon="heart">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
          2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3
          16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
      <span class="label">المحفوظات</span>
    </div>
    <!-- زر تبديل الوضع -->
    <div class="menu-item" id="menu-darkmode" title="تبديل الوضع">
      <svg id="darkmode-icon" viewBox="0 0 24 24">
        <path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1012 21a9 9 0 009-8.21z"/>
      </svg>
      <span class="label">الوضع</span>
    </div>
  </div>
  
  <!-- شريط البحث الذي يتمدد عند النقر -->
  <div id="search-bar-container">
    <input type="text" id="search-bar" placeholder="ابحث عن منتج...">
  </div>
  
  <!-- منطقة المحتوى -->
  <div class="main-content">
    <header>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1><i><b>مكتب قمة الرافدين العلمي</b></i></h1>
        <!-- عرض عدد الأعضاء مع أيقونة -->
        <div class="member-count">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span id="member-count"></span>
        </div>
      </div>
      <p><i><b>خصم على القائمة 10%</b></i></p>
    </header>
    <!-- شبكة المنتجات -->
    <div class="product-grid" id="product-grid">
      <!-- تُحقن بطاقات المنتجات عبر JavaScript -->
    </div>
  </div>
  
  <!-- زر السلة العائم مع رمز جديد (مثال على أيقونة حقيبة التسوق) -->
  <button class="fab-cart" id="fab-cart">
    <svg viewBox="0 0 24 24" width="28" height="28">
      <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
      0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2M7.82 
      14h8.36c.75 0 1.41-.41 1.75-1.03l3.24-5.88c.2-.36.29-.78.22-1.19-.08-.41-.33-.76-.7-.98A1.997 
      1.997 0 0019.5 5H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C5.16 
      16.37 5 16.68 5 17c0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 
      14z" fill="#fff"/>
    </svg>
  </button>
  
  <!-- نوافذ منبثقة: سلة الشراء، المحفوظات، الأكثر مبيعا، وتكبير صورة المنتج -->
  <div class="modal-overlay" id="cart-modal">
    <div class="modal-content" id="cart-modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <div id="modal-dynamic-content">
        <!-- محتوى النافذة الديناميكي -->
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="favorites-modal">
    <div class="modal-content" id="favorites-modal-content">
      <button class="modal-close" id="favorites-modal-close">&times;</button>
      <div id="favorites-content">
        <!-- منتجات المحفوظات -->
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="most-sold-modal">
    <div class="modal-content" id="most-sold-modal-content">
      <button class="modal-close" id="most-sold-modal-close">&times;</button>
      <div id="most-sold-content">
        <!-- منتجات الأكثر مبيعا -->
      </div>
    </div>
  </div>
  
  <div class="modal-overlay" id="image-modal">
    <div class="modal-content image-modal-content">
      <button class="modal-close" id="image-modal-close">&times;</button>
      <img id="modal-image" src="" alt="صورة المنتج">
    </div>
  </div>
  
  <!-- سكريبت التحكم -->
  <script>
    /* تعريف الرموز (validCodes) في النطاق العام حتى نتمكن من استخدامها لحساب عدد الأعضاء */
    const validCodes = ["272311", "07730799909", "07736374464", "07802431779", "07822632020", "07854009540", "07804984615", "07737530689", "0000"];
  
    // التحقق من الرمز قبل عرض الموقع
    (function(){
      let code = prompt("يرجى إدخال الرمز للوصول إلى الموقع:");
      while (!validCodes.includes(code)) {
        alert("الرمز غير صحيح. الرجاء المحاولة مرة أخرى.");
        code = prompt("يرجى إدخال الرمز للوصول إلى الموقع:");
      }
    })();
  
    /* بيانات المنتجات والسلة والمحفظات */
    const products = [
      { id: 1, name: "نورمل سلاين 100ml", details: " كارتون 100 قطعة", price: 65000, quantity: 0, image: "https://i.ibb.co/WNsF15CM/photo.jpg" },
      { id: 2, name: "paracetamol 100ml", details: "سعر البطل " , price: 1600, quantity: 0, image: "https://i.ibb.co/d453gYqS/photo.jpg" },
      { id: 3, name: "نورمل سلاين 500ml", details:"الكارتون يحتوي على 30 بطل سعر بطل 1450" , price: 43500, quantity: 0, image: "https://i.ibb.co/394K9cNK/photo.jpg" },
      { id: 5, name: "NORMAL SALINE 100ml هندي", details: "الكارتون 100 قطعة " , price: 55000, quantity: 0, image: "https://i.ibb.co/JRkxgqkX/photo-4.jpg" },
      { id: 6, name: "Ringer 500ml", details: "الكارتون 30 بطل ", price: 42000, quantity: 0, image: "https://i.ibb.co/sp3K8RWk/photo.jpg" },
      { id: 7, name: "جهاز اعطاء سوائل", details: "الكارتون 500 قطعة ", price: 87000, quantity: 0, image: "https://i.ibb.co/60wvbccf/photo-3.jpg" },
      { id: 8, name: "كلكوز سلاين 500ml", details: "الكارتون 30 بطل ", price: 42000, quantity: 0, image: "https://i.ibb.co/7xwdFwHf/photo-2.jpg" },
      { id: 9, name: "Distilled water 5ml", details: "الكارتون 20 باكيت", price: 260000, quantity: 0, image: "https://i.ibb.co/Fkv7SkGF/photo-5.jpg" },
      { id: 10, name: "كانيولا خضراء", details: "باكيت 100 قطعة", price: 19000, quantity: 0, image: "https://i.ibb.co/1tMmr13y/photo-2.jpg" },
      { id: 11, name: "حمل test", details: "الباكيت 40 قطعة", price: 7000, quantity: 0, image: "https://i.ibb.co/LXn7KhwW/photo.jpg" },
      { id: 12, name: "لاسق جروح فوجيكا", details: "الكارتون 40 باكيت", price: 2750, quantity: 0, image: "https://i.ibb.co/Qvf28W8c/photo-5.jpg" },
      { id: 13, name: "جهاز سكر انكل بلص", price: 15000, quantity: 0, image: "https://i.ibb.co/S47sNJm4/photo-4.jpg" },
      { id: 14, name: "شرائح سكر انكل بلص", details:" القطعة " , price: 4200, quantity: 0, image: "https://i.ibb.co/WvFctGjd/photo-3.jpg" },
      { id: 15, name: "Lido plus بخاخ اسنان", details: "الكارتون 100 قطعة ", price:160000, quantity: 0, image: "https://i.ibb.co/R4yjrF8Z/photo.jpg" },
      { id: 16, name: "سرنجة 1cc", details: " الباكيت", price: 5200, quantity: 0, image: "https://i.ibb.co/sTj3Kmf/photo-2.jpg" },
      { id: 17, name: "كانيولا وردية ", details: "الباكيت 100", price: 19000, quantity: 0, image: "https://i.ibb.co/MxDCqbY2/photo.jpg" },
      { id: 18, name: "كانيولا صفرة", details: " الباكيت 100", price: 19000, quantity: 0, image: "https://i.ibb.co/1ff6nNsc/photo-3.jpg" },
      { id: 19, name: "كانيولا زرقاء", details: "الكارتون 100 قطعة", price: 19000, quantity: 0, image: "https://i.ibb.co/tk5k0Jk/photo.jpg" },
      { id: 20, name: "سرنجة 5cc", details: " الباكيت 4500 الكارتون " , price: 108000, quantity: 0, image: "https://i.ibb.co/DPVp0dyS/photo.jpg" },
      { id: 21, name: "مزلق مساج ومحفز بلفواكه " , details:"القطعة " , price: 3000, quantity: 0, image: "https://i.ibb.co/DPLZxFzf/photo-2.jpg" },
      { id: 22, name: "فلاش كاركاس فواكه", details:"جميع الانواع ", price: 9500, quantity: 0, image: "https://i.ibb.co/jPB3sxzM/photo-5.jpg" },
      { id: 23, name: "سرنجة 3 cc ", details: " الباكيت 4851 الكارتون ", price: 131000, quantity: 0, image: "https://i.ibb.co/8LbNmqvW/photo.jpg" },
      { id: 24, name: "كريم تكبير ارداف وصدر ", details: " الدرزن 12 قطعة 3000", price: 48000, quantity: 0, image: "https://i.ibb.co/9k2nn84C/photo-3.jpg" },
      { id: 24, name: "فلاجين فيال ", details: " سعر البطل ", price: 1600, quantity: 0, image: "https://i.ibb.co/ZRbL5Trr/photo-4.jpg" },
    ];
  
    let cart = []; // عناصر سلة الشراء
    let savedProducts = JSON.parse(localStorage.getItem("savedProducts")) || [];
  
    // (مثال لتحديد المنتجات الأكثر مبيعاً إذا رغبت)
    const mostSoldProductIds = [2, 5, 7, 10];
  
    /* دوال عرض المنتجات */
    function renderProducts(productArray = products) {
      const grid = document.getElementById("product-grid");
      grid.innerHTML = "";
      productArray.forEach((product, index) => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.setAttribute("data-product-id", product.id);
        // إذا كانت البطاقة من أول خمس، نضيف شارة ونسميها best-seller
        let badge = "";
        if (index < 5) {
          badge = `<div class="best-seller-badge">الأكثر مبيعاً</div>`;
          card.classList.add("best-seller");
        }
        card.innerHTML = `
          ${badge}
          <img src="${product.image}" alt="${product.name}" ondblclick="showImageModal('${product.image}')">
          <!-- زر حفظ المنتج -->
          <button class="save-btn ${isSaved(product.id) ? 'active' : ''}" onclick="toggleSave(${product.id}, this)">
            <svg viewBox="0 0 24 24">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
                2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3
                16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </button>
          <div class="card-body">
            <div class="product-title">${product.name}</div>
            ${ product.details ? `<div class="product-details">${product.details}</div>` : "" }
            <div class="product-price">${product.price} IQD</div>
            <div class="quantity-controls">
              <button onclick="updateQuantity(${product.id}, -1, this)">-</button>
              <span id="qty-${product.id}">0</span>
              <button onclick="updateQuantity(${product.id}, 1, this)">+</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }
  
    /* التحقق من حفظ المنتج */
    function isSaved(productId) {
      return savedProducts.includes(productId);
    }
  
    /* تبديل حفظ المنتج */
    function toggleSave(productId, btn) {
      if (isSaved(productId)) {
        savedProducts = savedProducts.filter(id => id !== productId);
        btn.classList.remove("active");
      } else {
        savedProducts.push(productId);
        btn.classList.add("active");
        btn.classList.add("animate-heart");
        setTimeout(() => btn.classList.remove("animate-heart"), 500);
      }
      localStorage.setItem("savedProducts", JSON.stringify(savedProducts));
    }
  
    /* تحديث الكمية */
    function updateQuantity(productId, change, btn) {
      const qtyEl = document.getElementById("qty-" + productId);
      let currentQty = parseInt(qtyEl.textContent);
      currentQty = Math.max(0, currentQty + change);
      qtyEl.textContent = currentQty;
  
      btn.classList.add("shake");
      setTimeout(() => btn.classList.remove("shake"), 300);
  
      animateIndicator(btn, change > 0 ? 'plus' : 'minus');
  
      const existing = cart.find(item => item.id === productId);
      if (existing) {
        if (currentQty === 0) {
          cart = cart.filter(item => item.id !== productId);
        } else {
          existing.quantity = currentQty;
        }
      } else {
        if (currentQty > 0) {
          cart.push({ id: productId, quantity: currentQty });
        }
      }
    }
  
    /* إنشاء مؤشر الحركة */
    function animateIndicator(btn, type) {
      const indicator = document.createElement("span");
      indicator.className = "indicator " + (type === 'plus' ? "plus-indicator" : "minus-indicator");
      indicator.textContent = type === 'plus' ? "+" : "-";
      const container = btn.parentElement;
      const btnLeft = btn.offsetLeft;
      const btnTop = btn.offsetTop;
      const btnCenterX = btnLeft + btn.offsetWidth/2 - 10;
      indicator.style.left = btnCenterX + "px";
      indicator.style.top = btnTop + "px";
      container.appendChild(indicator);
      setTimeout(() => indicator.remove(), 500);
    }
  
    /* تصفية المنتجات بناءً على البحث */
    function filterProducts(query) {
      const filtered = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
      renderProducts(filtered);
    }
  
    /* نوافذ منبثقة */
    function openCartModal() {
      const modalOverlay = document.getElementById("cart-modal");
      const dynamicContent = document.getElementById("modal-dynamic-content");
      dynamicContent.innerHTML = renderCartSummary();
      modalOverlay.classList.add("active");
    }
  
    function renderCartSummary() {
      if (cart.length === 0) {
        return `<div class="modal-header"><h4>سلة الشراء فارغة</h4></div>`;
      }
      let html = `<div class="modal-header"><h4>ملخص سلة الشراء</h4></div><div class="modal-body">`;
      let total = 0;
      cart.forEach(item => {
        const product = products.find(p => p.id === item.id);
        const productTotal = product.price * item.quantity;
        total += productTotal;
        html += `<div class="cart-item" onclick="scrollToProduct(${product.id})">
          <div>${product.name} (×${item.quantity})</div>
          <div>${productTotal} IQD</div>
        </div>`;
      });
      html += `</div>
        <div class="cart-total">المجموع الكلي: ${total} IQD</div>
        <button class="btn btn-primary btn-purchase" onclick="showPharmacyForm()">شراء</button>`;
      return html;
    }
  
    function showPharmacyForm() {
      const dynamicContent = document.getElementById("modal-dynamic-content");
      dynamicContent.innerHTML = `
        <div class="modal-header"><h4>معلومات الصيدلية</h4></div>
        <div class="modal-body">
          <form id="pharmacy-form" class="pharmacy-form">
            <input type="text" id="pharmacy-name" class="form-control" placeholder="اسم الصيدلية" required>
            <input type="text" id="pharmacy-address" class="form-control" placeholder="العنوان" required>
            <input type="text" id="pharmacy-phone" class="form-control" placeholder="رقم الهاتف" required>
            <textarea id="pharmacy-notes" class="form-control" placeholder="ملاحظات"></textarea>
            <button type="submit" class="btn btn-success btn-purchase mt-2">أرسل الطلب عبر الواتساب</button>
          </form>
        </div>
      `;
      document.getElementById("pharmacy-form").addEventListener("submit", function(e) {
        e.preventDefault();
        sendOrder();
      });
    }
  
    // في بداية السكريبت، عرف متغيراً لتخزين مرجع النافذة المفتوحة
// تعريف متغير لتخزين مرجع نافذة واتساب المفتوحة
let whatsappWindow = null;

function sendOrder() {
  const pharmacyName = document.getElementById("pharmacy-name").value.trim();
  const pharmacyAddress = document.getElementById("pharmacy-address").value.trim();
  const pharmacyPhone = document.getElementById("pharmacy-phone").value.trim();
  const pharmacyNotes = document.getElementById("pharmacy-notes").value.trim();

  if (!pharmacyName || !pharmacyAddress || !pharmacyPhone) {
    alert("يرجى ملء جميع الحقول المطلوبة.");
    return;
  }

  // بناء الرسالة التي ستُرسل إلى الواتس
  let message = "� *تفاصيل المنتجات*:%0A";
  cart.forEach((item, index) => {
    const product = products.find(p => p.id === item.id);
    const productTotal = product.price * item.quantity;
    message += "--------------------------------%0A";
    message += `� *المنتج ${index + 1}:* ${product.name}%0A`;
    message += `� *السعر:* ${product.price} IQD%0A`;
    message += `� *الكمية:* ${item.quantity}%0A`;
    message += `� *الإجمالي:* ${productTotal} IQD%0A`;
  });
  message += "--------------------------------%0A";

  const total = cart.reduce((sum, item) => {
    const product = products.find(p => p.id === item.id);
    return sum + (product.price * item.quantity);
  }, 0);

  message += `%0A� *المجموع الكلي*: ${total} IQD%0A%0A`;
  message += "� *معلومات الصيدلية *:%0A";
  message += `• *الاسم*: ${pharmacyName}%0A`;
  message += `• *رقم الهاتف*: ${pharmacyPhone}%0A`;
  message += `• *العنوان*: ${pharmacyAddress}%0A`;
  if(pharmacyNotes) {
    message += `• *الملاحظات*: ${pharmacyNotes}%0A`;
  }

  // رقم الواتس ورابط فتح الرسالة
  const whatsappNumber = "9647824130002";
  const url = `https://wa.me/${whatsappNumber}?text=${message}`;

  // إذا كانت نافذة واتساب مفتوحة من قبل، يتم إغلاقها
  if (whatsappWindow && !whatsappWindow.closed) {
    whatsappWindow.close();
  }
  // فتح نافذة جديدة والاحتفاظ بمرجعها
  whatsappWindow = window.open(url, "_blank");
}

  
    /* دوال المحفوظات */
    function openFavoritesModal() {
      const favModal = document.getElementById("favorites-modal");
      document.getElementById("favorites-content").innerHTML = renderFavorites();
      favModal.classList.add("active");
    }
  
    function renderFavorites() {
      const favProducts = products.filter(p => savedProducts.includes(p.id));
      if (favProducts.length === 0) {
        return `<div class="modal-header"><h4>لا توجد منتجات محفوظة</h4></div>`;
      }
      let html = `<div class="modal-header"><h4>المحفوظات</h4></div><div class="modal-body">`;
      favProducts.forEach(product => {
        html += `<div class="cart-item" onclick="scrollToProduct(${product.id})">
          <div>${product.name}</div>
          <div>${product.price} IQD</div>
        </div>`;
      });
      html += `</div>`;
      return html;
    }
  
    /* دوال الأكثر مبيعاً */
    function openMostSoldModal() {
      const modal = document.getElementById("most-sold-modal");
      document.getElementById("most-sold-content").innerHTML = renderMostSold();
      modal.classList.add("active");
    }
  
    function renderMostSold() {
      // يمكنك تعديل التصفية حسب احتياجك؛ هنا نستخدم المصفوفة mostSoldProductIds
      const mostSold = products.filter(p => mostSoldProductIds.includes(p.id));
      if (mostSold.length === 0) {
        return `<div class="modal-header"><h4>لا توجد منتجات</h4></div>`;
      }
      let html = `<div class="modal-header"><h4>الأكثر مبيعا</h4></div><div class="modal-body">`;
      mostSold.forEach(product => {
        html += `<div class="cart-item" onclick="scrollToProduct(${product.id})">
          <div>${product.name}</div>
          <div>${product.price} IQD</div>
        </div>`;
      });
      html += `</div>`;
      return html;
    }
  
    /* التوجيه لبطاقة المنتج مع إخفاء النوافذ المنبثقة */
    function scrollToProduct(productId) {
      const card = document.querySelector(`.product-card[data-product-id="${productId}"]`);
      if (card) {
        card.classList.add("highlight");
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => card.classList.remove("highlight"), 1500);
      }
      // إخفاء نوافذ المحفوظات والأكثر مبيعاً
      document.getElementById("favorites-modal").classList.remove("active");
      document.getElementById("most-sold-modal").classList.remove("active");
    }
  
    /* أحداث النقر على عناصر الشريط الجانبي */
    document.getElementById("toggle-sidebar").addEventListener("click", function(e) {
      document.getElementById("sidebar").classList.toggle("expanded");
      e.stopPropagation();
    });
  
    document.getElementById("menu-home").addEventListener("click", function() {
      this.querySelector("svg").classList.add("animate-home");
      setTimeout(() => this.querySelector("svg").classList.remove("animate-home"), 500);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  
    // زر البحث: تمديد شريط البحث وتغيير رمز الزر عند النقر
    document.getElementById("menu-search").addEventListener("click", function() {
      this.querySelector("svg").classList.add("animate-search");
      setTimeout(() => this.querySelector("svg").classList.remove("animate-search"), 500);
      const searchContainer = document.getElementById("search-bar-container");
      searchContainer.classList.toggle("active");
      if(searchContainer.classList.contains("active")){
        // تغيير رمز البحث إلى رمز الإغلاق (×)
        this.querySelector("svg").innerHTML = '<line x1="18" y1="6" x2="6" y2="18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/><line x1="6" y1="6" x2="18" y2="18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/>';
        document.getElementById("search-bar").focus();
      } else {
        // إعادة رمز البحث الأصلي
        this.querySelector("svg").innerHTML = '<path d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" fill="none"/>';
      }
    });
  
    // زر الأكثر مبيعاً
    document.getElementById("menu-most-sold").addEventListener("click", function() {
      this.querySelector("svg").classList.add("animate-heart");
      setTimeout(() => this.querySelector("svg").classList.remove("animate-heart"), 500);
      openMostSoldModal();
    });
  
    document.getElementById("menu-favorites").addEventListener("click", function() {
      this.querySelector("svg").classList.add("animate-heart");
      setTimeout(() => this.querySelector("svg").classList.remove("animate-heart"), 500);
      openFavoritesModal();
    });
  
    document.getElementById("menu-darkmode").addEventListener("click", function() {
      const icon = document.getElementById("darkmode-icon");
      icon.classList.add("toggle-animation");
      setTimeout(() => {
        document.body.classList.toggle("dark-mode");
        if (document.body.classList.contains("dark-mode")) {
          icon.innerHTML = `<circle cx="12" cy="12" r="5" fill="var(--primary-color)"/>
            <g stroke="var(--primary-color)" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="4"/>
              <line x1="12" y1="20" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
              <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="4" y2="12"/>
              <line x1="20" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
              <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
            </g>`;
        } else {
          icon.innerHTML = `<path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1012 21a9 9 0 009-8.21z" fill="var(--primary-color)"/>`;
        }
        icon.classList.remove("toggle-animation");
      }, 500);
    });
  
    document.getElementById("fab-cart").addEventListener("click", openCartModal);
    document.getElementById("modal-close").addEventListener("click", function() {
      document.getElementById("cart-modal").classList.remove("active");
    });
    document.getElementById("favorites-modal-close").addEventListener("click", function() {
      document.getElementById("favorites-modal").classList.remove("active");
    });
    document.getElementById("most-sold-modal-close").addEventListener("click", function() {
      document.getElementById("most-sold-modal").classList.remove("active");
    });
  
    /* عرض نافذة تكبير الصورة */
    function showImageModal(src) {
      const modal = document.getElementById("image-modal");
      document.getElementById("modal-image").src = src;
      modal.classList.add("active");
    }
    document.getElementById("image-modal-close").addEventListener("click", function() {
      document.getElementById("image-modal").classList.remove("active");
    });
  
    // تفعيل التصفية عند الكتابة في شريط البحث
    document.getElementById("search-bar").addEventListener("keyup", function() {
      filterProducts(this.value);
    });
  
    /* تهيئة عرض المنتجات */
    renderProducts();
  
    // عند تحميل الصفحة، حساب وعرض عدد الأعضاء (عدد الرموز + 5000)
    document.addEventListener("DOMContentLoaded", function() {
      const memberCountEl = document.getElementById("member-count");
      if(memberCountEl) {
        const count = validCodes.length + 5000;
        memberCountEl.textContent = count;
      }
    });
  </script>
  
</body>
</html>
