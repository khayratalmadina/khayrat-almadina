<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>مذخر فيتامين</title>
  <!-- Bootstrap 5 مع RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- خط Cairo -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
  <!-- إضافة مكتبات Firebase (الإصدار 8 لتسهيل الدمج مع الكود الحالي) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    /* تعريف ألوان متجر  */
    :root {
      --primary-color: #d10000;   /* وردي حيوي */
      --secondary-color: #5a0000; /* بنفسجي */
      --accent-color: #000000;    /* وردي فاتح */
      --background: #ffffff;      /* خلفية وردية فاتحة */
      --sidebar-bg: #ffffff;
      --modal-bg: rgba(0, 0, 0, 0.7);
    }
    
    /* تنسيق الخط والخلفية العامة */
    body {
      font-family: 'Cairo', sans-serif;
      background: var(--background);
      margin: 0;
      padding: 0;
      transition: background 0.3s ease;
    }
    body.dark-mode {
      background: #2c3e50;
      color: #ecf0f1;
    }
    
    /* تنسيق الشريط الجانبي */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 50px;
      height: 100%;
      background: var(--sidebar-bg);
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.8rem 0;
      transition: width 0.3s ease;
      border-top-right-radius: 10px;
      border-bottom-right-radius: 10px;
      z-index: 1200;
    }
    .sidebar.expanded {
      width: 200px;
    }
    .sidebar .menu-item {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0.8rem 0;
      cursor: pointer;
      position: relative;
      transition: background 0.3s;
    }
    #toggle-sidebar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
    }
    .sidebar .menu-item:hover {
      background: rgba(0,0,0,0.05);
    }
    .sidebar.expanded .menu-item {
      justify-content: flex-start;
      padding-left: 1rem;
    }
    .sidebar .menu-item span.label {
      display: none;
      margin-left: 0.5rem;
      font-size: 1rem;
      color: var(--primary-color);
    }
    .sidebar.expanded .menu-item span.label {
      display: inline;
    }
    .sidebar .menu-item svg {
      width: 24px;
      height: 24px;
      fill: var(--primary-color);
    }
    
    /* تنسيق الواجهة الرئيسية */
    .main-content {
      margin-left: 80px;
      padding: 0.5rem 1rem;
      position: relative;
    }
    header {
      background: linear-gradient(to right, var(--primary-color), var(--accent-color));
      color: #fff;
      padding: 0.8rem 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-radius: 0 0 10px 10px;
    }
    header h1 {
      font-size: 1.8rem;
      margin: 0;
    }
    header p {
      font-size: 1rem;
      margin: 0.3rem 0 0;
    }
    .member-count {
      background: rgba(255,255,255,0.8);
      padding: 0.3rem 0.7rem;
      border-radius: 5px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .order-counter {
      background: rgba(255,255,255,0.8);
      padding: 0.3rem 0.7rem;
      border-radius: 5px;
      font-size: 0.9rem;
      margin-top: 0.3rem;
    }
    
    /* شريط البحث */
    #search-bar-container {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      overflow: hidden;
      transition: width 0.5s ease;
      z-index: 1500;
    }
    #search-bar-container.active {
      width: 80%;
      max-width: 400px;
    }
    #search-bar {
      width: 100%;
      padding: 0.3rem 0.5rem;
      font-size: 0.9rem;
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      outline: none;
    }
    
    /* بطاقات المنتجات */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 0.8rem;
    }
    .product-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .product-card:hover {
      transform: translateY(-3px);
    }
    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      cursor: pointer;
    }
    .product-card .card-body {
      padding: 0.4rem 0.6rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .product-card .product-title {
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .product-card .product-details {
      font-size: 0.8rem;
      color: #7f8c8d;
      margin-bottom: 0.5rem;
    }
    .product-card .product-price {
      font-size: 0.9rem;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
    .best-seller-badge {
      position: absolute;
      top: 0;
      left: 0;
      background: var(--accent-color);
      color: #fff;
      padding: 4px 8px;
      font-size: 0.8rem;
      font-weight: bold;
      border-bottom-right-radius: 10px;
      z-index: 5;
    }
    .best-seller {
      border: 2px solid var(--accent-color);
    }
    
    /* التحكم في الكمية والمؤثرات */
    .quantity-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      margin-top: auto;
      position: relative;
    }
    .quantity-controls button {
      border: none;
      background: var(--secondary-color);
      color: #fff;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }
    .quantity-controls button:hover {
      background: #7B1FA2;
    }
    .quantity-controls span {
      font-size: 1rem;
      width: 20px;
      text-align: center;
    }
    .indicator {
      pointer-events: none;
      font-size: 2rem;
      font-weight: bold;
      opacity: 1;
      position: absolute;
      z-index: 10;
    }
    .plus-indicator {
      color: green;
      animation: plusAnim 0.5s ease forwards;
    }
    .minus-indicator {
      color: red;
      animation: minusAnim 0.5s ease forwards;
    }
    @keyframes plusAnim {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-30px) scale(1.5); }
    }
    @keyframes minusAnim {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(30px) scale(1.5); }
    }
    @keyframes shake {
      0% { transform: translate(0, 0); }
      25% { transform: translate(-2px, 0); }
      50% { transform: translate(2px, 0); }
      75% { transform: translate(-2px, 0); }
      100% { transform: translate(0, 0); }
    }
    .shake {
      animation: shake 0.3s ease;
    }
    .save-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .save-btn svg {
      width: 24px;
      height: 24px;
      fill: #ccc;
      transition: fill 0.3s;
    }
    .save-btn.active svg {
      fill: var(--primary-color);
    }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .animate-heart {
      animation: heartbeat 0.5s ease;
    }
    @keyframes searchBounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .animate-search {
      animation: searchBounce 0.5s ease;
    }
    
    /* زر السلة العائم */
    .fab-cart {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: var(--primary-color);
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.5rem;
      z-index: 1300;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.3s;
    }
    .fab-cart:hover {
      transform: scale(1.1);
    }
    
    /* النوافذ المنبثقة */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
      z-index: 1400;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal-content {
      background: #fff;
      border-radius: 10px;
      padding: 1.2rem;
      width: 90%;
      max-width: 500px;
      position: relative;
      animation: slideIn 0.3s ease;
      font-size: 1rem;
      color: #333;
    }
    body.dark-mode .modal-content {
      background: #2c3e50;
      color: #ecf0f1;
    }
    @keyframes slideIn {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      border: none;
      background: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 0.3rem;
      cursor: pointer;
    }
    .cart-total {
      text-align: right;
      font-weight: bold;
      margin-top: 1rem;
    }
    .btn-purchase {
      width: 100%;
      margin-top: 1rem;
    }
    .pharmacy-form input,
    .pharmacy-form textarea {
      margin-bottom: 0.8rem;
      font-size: 1rem;
      padding: 0.5rem;
    }
    .modal-header h4,
    .modal-header h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .modal-body,
    #favorites-content,
    #most-sold-content {
      font-size: 1rem;
    }
    .toggle-animation {
      animation: iconRotate 0.5s ease;
    }
    @keyframes iconRotate {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }
    .animate-home {
      animation: homeBounce 0.5s ease;
    }
    @keyframes homeBounce {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .image-modal-content {
      width: 35vw;
      height: 35vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      border-radius: 10px;
      position: relative;
    }
    .image-modal-content img {
      max-width: 100%;
      max-height: 100%;
    }
    .highlight {
      animation: highlightAnim 1s ease;
    }
    @keyframes highlightAnim {
      0% { box-shadow: 0 0 10px yellow; }
      100% { box-shadow: none; }
    }
    
    /* نافذة إدارة داخلية (دون قسم الرموز) */
    #admin-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--modal-bg);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
    }
    #admin-modal.active {
      display: flex;
    }
    #admin-modal .admin-content {
      background: #fff;
      padding: 1rem;
      border-radius: 10px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .admin-header {
      text-align: center;
      margin-bottom: 1rem;
    }
    .admin-section {
      margin-bottom: 1rem;
    }
    .admin-section h3 {
      margin-bottom: 0.5rem;
    }
    /* إضافة تنسيق للنوافذ المنبثقة الخاصة بلوحة الإدارة */
    #admin-modal .admin-content {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }
    #admin-modal .admin-content:hover {
      transform: scale(1.02);
    }

    /* تحسين تنسيق نماذج الإدخال في لوحة الإدارة */
    #admin-modal input,
    #admin-modal textarea {
      width: 100%;
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 5px;
      margin-bottom: 1rem;
    }

    /* تخصيص ألوان الوضع الليلي للوحات الإدارة */
    body.dark-mode #admin-modal .admin-content {
      background: #2c3e50;
      color: #ecf0f1;
    }
    
    /* تحسينات للوضع الليلي */
    body.dark-mode .sidebar {
      background: #34495e;
    }
    body.dark-mode .sidebar .menu-item span.label {
      color: #ecf0f1;
    }
    body.dark-mode .sidebar .menu-item svg {
      fill: #ecf0f1;
    }
    body.dark-mode .product-card {
      background: #34495e;
      color: #ecf0f1;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
    }
    body.dark-mode .product-card .product-details {
      color: #c7bdbd;
    }
    body.dark-mode .product-card .product-price {
      color: var(--primary-color);
    }
    
  </style>
</head>
<body>
  <!-- الشريط الجانبي -->
  <div class="sidebar" id="sidebar">
    <div class="menu-item" id="toggle-sidebar" title="القائمة">
      <svg viewBox="0 0 24 24">
        <path d="M3 6h18M3 12h18M3 18h18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span class="label">القائمة</span>
    </div>
    <div class="menu-item" id="menu-home" title="الرئيسية">
      <svg viewBox="0 0 24 24">
        <path d="M12 3l9 8-3 3-6 6-6-6-3-3 9-8z"/>
      </svg>
      <span class="label">الرئيسية</span>
    </div>
    <div class="menu-item" id="menu-search" title="بحث">
      <svg viewBox="0 0 24 24">
        <path d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" fill="none"/>
      </svg>
      <span class="label">بحث</span>
    </div>
    <div class="menu-item" id="menu-most-sold" title="الأكثر مبيعا">
      <svg viewBox="0 0 24 24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" stroke="var(--primary-color)" stroke-width="2" fill="none"/>
      </svg>
      <span class="label">الأكثر مبيعا</span>
    </div>
    <div class="menu-item" id="menu-favorites" title="المحفوظات">
      <svg viewBox="0 0 24 24" data-icon="heart">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
          2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3
          16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
      <span class="label">المحفوظات</span>
    </div>
    <div class="menu-item" id="menu-darkmode" title="تبديل الوضع">
      <svg id="darkmode-icon" viewBox="0 0 24 24">
        <path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1012 21a9 9 0 009-8.21z"/>
      </svg>
      <span class="label">الوضع</span>
    </div>
  </div>
  
  <!-- شريط البحث -->
  <div id="search-bar-container">
    <input type="text" id="search-bar" placeholder="ابحث عن منتج...">
  </div>
  
  <!-- الواجهة الرئيسية -->
  <div class="main-content">
    <header>
      <div>
        <h1><i><b>مذخر فيتامين</b></i></h1>
        <p><i>اكتشف أفضل المنتجات <br>07808560009</i></p>
      </div>
      <div>
        <div class="member-count d-inline-block me-3">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
          <span id="member-count"></span>
        </div>
        <div class="order-counter d-inline-block">
          طلبات: <span id="order-count">0</span>
        </div>
      </div>
    </header>
    <div class="product-grid" id="product-grid">
      <!-- بطاقات المنتجات ستُحقن هنا بواسطة الجافاسكريبت -->
    </div>
  </div>
  
  <!-- زر السلة العائم -->
  <button class="fab-cart" id="fab-cart">
    <svg viewBox="0 0 24 24" width="28" height="28">
      <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 
      0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2M7.82 
      14h8.36c.75 0 1.41-.41 1.75-1.03l3.24-5.88c.2-.36.29-.78.22-1.19-.08-.41-.33-.76-.7-.98A1.997 
      1.997 0 0019.5 5H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C5.16 
      16.37 5 16.68 5 17c0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 
      14z" fill="#fff"/>
    </svg>
  </button>
  
  <!-- النوافذ المنبثقة -->
  <div class="modal-overlay" id="cart-modal">
    <div class="modal-content" id="cart-modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <div id="modal-dynamic-content"></div>
    </div>
  </div>
  <div class="modal-overlay" id="favorites-modal">
    <div class="modal-content" id="favorites-modal-content">
      <button class="modal-close" id="favorites-modal-close">&times;</button>
      <div id="favorites-content"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-danger" id="clear-favorites">حذف جميع المفضلات</button>
    </div>
    <script>
      document.getElementById("clear-favorites").addEventListener("click", function() {
        if (confirm("هل أنت متأكد من حذف جميع المفضلات؟")) {
          savedProducts = [];
          localStorage.setItem("savedProducts", JSON.stringify(savedProducts));
          document.getElementById("favorites-content").innerHTML = '<div class="modal-header"><h4>لا توجد منتجات محفوظة</h4></div>';
          document.querySelectorAll(".save-btn.active").forEach(btn => btn.classList.remove("active"));
        }
      });
    </script>
  </div>
  <div class="modal-overlay" id="most-sold-modal">
    <div class="modal-content" id="most-sold-modal-content">
      <button class="modal-close" id="most-sold-modal-close">&times;</button>
      <div id="most-sold-content"></div>
    </div>
  </div>
  <div class="modal-overlay" id="image-modal">
    <div class="modal-content image-modal-content">
      <button class="modal-close" id="image-modal-close">&times;</button>
      <img id="modal-image" src="" alt="صورة المنتج">
    </div>
  </div>
  
  <!-- نافذة إدارة داخلية (دون قسم الرموز) -->
  <div id="admin-modal">
    <div class="admin-content">
      <div class="admin-header">
        <h1>لوحة الإدارة</h1>
        <button id="admin-close" class="btn btn-secondary">خروج</button>
      </div>
      <div class="admin-section">
        <h3>إضافة منتج جديد</h3>
        <form id="add-product-form">
          <div class="mb-3">
            <label for="product-name" class="form-label">اسم المنتج</label>
            <input type="text" class="form-control" id="product-name" required>
          </div>
          <div class="mb-3">
            <label for="product-details" class="form-label">تفاصيل المنتج</label>
            <input type="text" class="form-control" id="product-details">
          </div>
          <div class="mb-3">
            <label for="product-price" class="form-label">السعر (IQD)</label>
            <input type="number" class="form-control" id="product-price" required>
          </div>
          <div class="mb-3">
            <label for="product-image" class="form-label">رابط صورة المنتج</label>
            <input type="text" class="form-control" id="product-image" required>
          </div>
          <button type="submit" class="btn btn-primary">أضف المنتج</button>
        </form>
      </div>
      <div class="admin-section">
        <h3>المنتجات المضافة</h3>
        <div id="admin-product-list"></div>
      </div>
    </div>
  </div>
  <br>
  <br><br>
 <!-- زر حذف المفضلات -->
<script>
  document.getElementById("clear-favorites").addEventListener("click", function() {
    if (confirm("هل أنت متأكد من حذف جميع المفضلات؟")) {
      savedProducts = [];
      localStorage.setItem("savedProducts", JSON.stringify(savedProducts));
      document.getElementById("favorites-content").innerHTML = '<div class="modal-header"><h4>لا توجد منتجات محفوظة</h4></div>';
      document.querySelectorAll(".save-btn.active").forEach(btn => btn.classList.remove("active"));
    }
  });
</script>

<!-- نوافذ المودال -->
</div>
<div class="modal-overlay" id="most-sold-modal">
  <div class="modal-content" id="most-sold-modal-content">
    <button class="modal-close" id="most-sold-modal-close">&times;</button>
    <div id="most-sold-content"></div>
  </div>
</div>
<div class="modal-overlay" id="image-modal">
  <div class="modal-content image-modal-content">
    <button class="modal-close" id="image-modal-close">&times;</button>
    <img id="modal-image" src="" alt="صورة المنتج">
  </div>
</div>

<!-- نافذة الإدارة الداخلية -->
<div id="admin-modal">
  <div class="admin-content">
    <div class="admin-header">
      <h1>لوحة الإدارة</h1>
      <button id="admin-close" class="btn btn-secondary">خروج</button>
    </div>
    <div class="admin-section">
      <h3>إضافة منتج جديد</h3>
      <form id="add-product-form">
        <div class="mb-3">
          <label for="product-name" class="form-label">اسم المنتج</label>
          <input type="text" class="form-control" id="product-name" required>
        </div>
        <div class="mb-3">
          <label for="product-details" class="form-label">تفاصيل المنتج</label>
          <input type="text" class="form-control" id="product-details">
        </div>
        <div class="mb-3">
          <label for="product-price" class="form-label">السعر (IQD)</label>
          <input type="number" class="form-control" id="product-price" required>
        </div>
        <div class="mb-3">
          <label for="product-image" class="form-label">رابط صورة المنتج</label>
          <input type="text" class="form-control" id="product-image" required>
        </div>
        <button type="submit" class="btn btn-primary">أضف المنتج</button>
      </form>
    </div>
    <div class="admin-section">
      <h3>المنتجات المضافة</h3>
      <div id="admin-product-list"></div>
    </div>
  </div>
</div>
<br>
<br><br>

<!-- الكود الرئيسي -->
<script>
  (function(){
    // إنشاء أيقونة الإدارة وإضافتها إلى الشريط الجانبي
    const sidebar = document.getElementById('sidebar');
    let adminIcon = document.createElement('div');
    adminIcon.id = 'admin-icon';
    adminIcon.title = 'إدارة المنتجات';
    adminIcon.style.cursor = 'pointer';
    adminIcon.style.marginTop = 'auto';
    adminIcon.style.padding = '0.8rem';
    adminIcon.innerHTML = '<svg viewBox="0 0 24 24" width="24" height="24"><path d="M12 2a10 10 0 00-7.07 17.07A10 10 0 1012 2zm1 14.93h-2v-2h2v2zm0-4h-2V7h2v5.93z" fill="var(--primary-color)"/></svg>';
    adminIcon.style.display = 'none';
    sidebar.appendChild(adminIcon);

    // دالة لتحديث ظهور أيقونة الإدارة بحسب حالة الشريط الجانبي
    function updateAdminIconVisibility() {
      adminIcon.style.display = sidebar.classList.contains('expanded') ? 'block' : 'none';
    }
    
    // مراقبة تغير صفات الشريط الجانبي لتحديث ظهور الأيقونة
    const observer = new MutationObserver(updateAdminIconVisibility);
    observer.observe(sidebar, { attributes: true, attributeFilter: ['class'] });
    
    // عند النقر على أيقونة الإدارة يتم طلب الرمز
    adminIcon.addEventListener('click', function(e){
      e.stopPropagation();
      const code = prompt("أدخل رمز الإدارة:");
      if(code === "220016") {
        document.getElementById("admin-modal").classList.add("active");
      } else {
        alert("رمز غير صحيح");
      }
    });
  })();

  // إعدادات Firebase الخاصة بمشروعك
  const firebaseConfig = {
    apiKey: "AIzaSyBcx6uXHzMK1HInEuFAmqsSBFvPAw86_Ts",
    authDomain: "mohmed-mod.firebaseapp.com",
    projectId: "mohmed-mod",
    storageBucket: "mohmed-mod.firebasestorage.app",
    messagingSenderId: "724585474855",
    appId: "1:724585474855:web:a95c26f01cf062db5e9702",
    measurementId: "G-34HJTJSXPZ"
  };
  firebase.initializeApp(firebaseConfig);
  var db = firebase.firestore();

  // تحديد معرف المتجر الحالي، قم بتغيير القيمة حسب كل متجر
  const storeId = "متجر 4";

  // المتغيرات العامة
  let products = [];  // ستُملأ المنتجات من قاعدة البيانات
  let cart = [];
  let savedProducts = JSON.parse(localStorage.getItem("savedProducts")) || [];
  const mostSoldProductIds = ["2", "5", "7", "10"]; // معرّفات المنتجات (سلاسل)

  // دالة تحميل المنتجات من Firestore مع تصفية حسب معرف المتجر
  function loadProducts() {
    db.collection("products").where("store", "==", storeId).get().then(querySnapshot => {
      products = [];
      querySnapshot.forEach(doc => {
        let product = doc.data();
        product.id = doc.id; // استخدام معرف الوثيقة
        products.push(product);
      });
      renderProducts();
    }).catch(error => {
      console.error("Error fetching products: ", error);
    });
  }

  // دالة عرض المنتجات في الواجهة
  function renderProducts(productArray = products) {
    const grid = document.getElementById("product-grid");
    grid.innerHTML = "";
    productArray.forEach((product, index) => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.setAttribute("data-product-id", product.id);
      let badge = "";
      if (index < 5) {
        badge = `<div class="best-seller-badge">الأكثر مبيعاً</div>`;
        card.classList.add("best-seller");
      }
      card.innerHTML = `
        ${badge}
        <img src="${product.image}" alt="${product.name}" ondblclick="showImageModal('${product.image}')">
        <button class="save-btn ${isSaved(product.id) ? 'active' : ''}" onclick="toggleSave('${product.id}', this)">
          <svg viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
              2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3
              16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
          </svg>
        </button>
        <div class="card-body">
          <div class="product-title">${product.name}</div>
          ${ product.details ? `<div class="product-details">${product.details}</div>` : "" }
          <div class="product-price">${product.price} IQD</div>
          <div class="quantity-controls">
            <button onclick="updateQuantity('${product.id}', -1, this)">-</button>
            <span id="qty-${product.id}">0</span>
            <button onclick="updateQuantity('${product.id}', 1, this)">+</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  function isSaved(productId) {
    return savedProducts.includes(productId);
  }

  function toggleSave(productId, btn) {
    if (isSaved(productId)) {
      savedProducts = savedProducts.filter(id => id !== productId);
      btn.classList.remove("active");
    } else {
      savedProducts.push(productId);
      btn.classList.add("active");
      btn.classList.add("animate-heart");
      setTimeout(() => btn.classList.remove("animate-heart"), 500);
    }
    localStorage.setItem("savedProducts", JSON.stringify(savedProducts));
  }

  function updateQuantity(productId, change, btn) {
    const qtyEl = document.getElementById("qty-" + productId);
    let currentQty = parseInt(qtyEl.textContent);
    currentQty = Math.max(0, currentQty + change);
    qtyEl.textContent = currentQty;
    btn.classList.add("shake");
    setTimeout(() => btn.classList.remove("shake"), 300);
    animateIndicator(btn, change > 0 ? 'plus' : 'minus');
    const existing = cart.find(item => item.id === productId);
    if (existing) {
      if (currentQty === 0) {
        cart = cart.filter(item => item.id !== productId);
      } else {
        existing.quantity = currentQty;
      }
    } else {
      if (currentQty > 0) {
        cart.push({ id: productId, quantity: currentQty });
      }
    }
  }

  function animateIndicator(btn, type) {
    const indicator = document.createElement("span");
    indicator.className = "indicator " + (type === 'plus' ? "plus-indicator" : "minus-indicator");
    indicator.textContent = type === 'plus' ? "+" : "-";
    const container = btn.parentElement;
    const btnLeft = btn.offsetLeft;
    const btnTop = btn.offsetTop;
    const btnCenterX = btnLeft + btn.offsetWidth / 2 - 10;
    indicator.style.left = btnCenterX + "px";
    indicator.style.top = btnTop + "px";
    container.appendChild(indicator);
    setTimeout(() => indicator.remove(), 500);
  }

  function filterProducts(query) {
    const filtered = products.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
    renderProducts(filtered);
  }

  function openCartModal() {
    const modalOverlay = document.getElementById("cart-modal");
    const dynamicContent = document.getElementById("modal-dynamic-content");
    dynamicContent.innerHTML = renderCartSummary();
    modalOverlay.classList.add("active");
  }

  function renderCartSummary() {
    if (cart.length === 0) {
      return `<div class="modal-header"><h4>سلة الشراء فارغة</h4></div>`;
    }
    let html = `<div class="modal-header"><h4>ملخص سلة الشراء</h4></div><div class="modal-body">`;
    let total = 0;
    cart.forEach(item => {
      const product = products.find(p => p.id === item.id);
      const productTotal = product.price * item.quantity;
      total += productTotal;
      html += `<div class="cart-item" onclick="scrollToProduct('${product.id}')">
        <div>${product.name} (×${item.quantity})</div>
        <div>${productTotal} IQD</div>
      </div>`;
    });
    html += `</div>
      <div class="cart-total">المجموع الكلي: ${total} IQD</div>
      <button class="btn btn-primary btn-purchase" onclick="showPharmacyForm()">شراء</button>`;
    return html;
  }

  function showPharmacyForm() {
    const dynamicContent = document.getElementById("modal-dynamic-content");
    dynamicContent.innerHTML = `
      <div class="modal-header"><h4>معلومات الصيدلية</h4></div>
      <div class="modal-body">
        <form id="pharmacy-form" class="pharmacy-form">
          <input type="text" id="pharmacy-name" class="form-control" placeholder="اسم الصيدلية" required>
          <input type="text" id="pharmacy-address" class="form-control" placeholder="العنوان" required>
          <input type="text" id="pharmacy-phone" class="form-control" placeholder="رقم الهاتف" required>
          <textarea id="pharmacy-notes" class="form-control" placeholder="ملاحظات"></textarea>
          <button type="submit" class="btn btn-success btn-purchase mt-2">أرسل الطلب عبر الواتساب</button>
        </form>
      </div>
    `;
    document.getElementById("pharmacy-form").addEventListener("submit", function(e) {
      e.preventDefault();
      sendOrder();
    });
  }

  let whatsappWindow = null;
  function sendOrder() {
    const pharmacyName = document.getElementById("pharmacy-name").value.trim();
    const pharmacyAddress = document.getElementById("pharmacy-address").value.trim();
    const pharmacyPhone = document.getElementById("pharmacy-phone").value.trim();
    const pharmacyNotes = document.getElementById("pharmacy-notes").value.trim();
    if (!pharmacyName || !pharmacyAddress || !pharmacyPhone) {
      alert("يرجى ملء جميع الحقول المطلوبة.");
      return;
    }
    let message = "� *تفاصيل المنتجات*:%0A";
    cart.forEach((item, index) => {
      const product = products.find(p => p.id === item.id);
      const productTotal = product.price * item.quantity;
      message += "--------------------------------%0A";
      message += `� *المنتج ${index + 1}:* ${product.name}%0A`;
      message += `� *السعر:* ${product.price} IQD%0A`;
      message += `� *الكمية:* ${item.quantity}%0A`;
      message += `� *الإجمالي:* ${productTotal} IQD%0A`;
    });
    message += "--------------------------------%0A";
    const total = cart.reduce((sum, item) => {
      const product = products.find(p => p.id === item.id);
      return sum + (product.price * item.quantity);
    }, 0);
    message += `%0A� *المجموع الكلي*: ${total} IQD%0A%0A`;
    message += "� *معلومات الصيدلية *:%0A";
    message += `• *الاسم*: ${pharmacyName}%0A`;
    message += `• *رقم الهاتف*: ${pharmacyPhone}%0A`;
    message += `• *العنوان*: ${pharmacyAddress}%0A`;
    if (pharmacyNotes) {
      message += `• *الملاحظات*: ${pharmacyNotes}%0A`;
    }
    const whatsappNumber = "9647824130002";
    const url = `https://wa.me/${whatsappNumber}?text=${message}`;

    // تحديث عداد الطلبات المحلي
    let orderCount = parseInt(localStorage.getItem("orderCount") || "0");
    orderCount++;
    localStorage.setItem("orderCount", orderCount);
    document.getElementById("order-count").textContent = orderCount;
    
    // حفظ بيانات الطلب في مجموعة "orders" بقاعدة Firebase
    const orderData = {
      pharmacyName: pharmacyName,
      pharmacyAddress: pharmacyAddress,
      pharmacyPhone: pharmacyPhone,
      pharmacyNotes: pharmacyNotes,
      cart: cart.map(item => {
        const product = products.find(p => p.id === item.id);
        return {
          name: product.name,
          price: product.price,
          quantity: item.quantity
        };
      }),
      total: total,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };
    db.collection("orders").add(orderData)
      .then(() => {
        console.log("تم حفظ الطلب بنجاح في قاعدة البيانات.");
      })
      .catch(error => {
        console.error("خطأ في حفظ الطلب:", error);
      });

    if (whatsappWindow && !whatsappWindow.closed) {
      whatsappWindow.close();
    }
    whatsappWindow = window.open(url, "_blank");
  }

  function openFavoritesModal() {
    const favModal = document.getElementById("favorites-modal");
    document.getElementById("favorites-content").innerHTML = renderFavorites();
    favModal.classList.add("active");
  }

  function renderFavorites() {
    const favProducts = products.filter(p => savedProducts.includes(p.id));
    if (favProducts.length === 0) {
      return `<div class="modal-header"><h4>لا توجد منتجات محفوظة</h4></div>`;
    }
    let html = `<div class="modal-header"><h4>المحفوظات</h4></div><div class="modal-body">`;
    favProducts.forEach(product => {
      html += `<div class="cart-item" onclick="scrollToProduct('${product.id}')">
        <div>${product.name}</div>
        <div>${product.price} IQD</div>
      </div>`;
    });
    html += `</div>`;
    return html;
  }

  function openMostSoldModal() {
    const modal = document.getElementById("most-sold-modal");
    document.getElementById("most-sold-content").innerHTML = renderMostSold();
    modal.classList.add("active");
  }

  function renderMostSold() {
    const mostSold = products.filter(p => mostSoldProductIds.includes(p.id));
    if (mostSold.length === 0) {
      return `<div class="modal-header"><h4>لا توجد منتجات</h4></div>`;
    }
    let html = `<div class="modal-header"><h4>الأكثر مبيعا</h4></div><div class="modal-body">`;
    mostSold.forEach(product => {
      html += `<div class="cart-item" onclick="scrollToProduct('${product.id}')">
        <div>${product.name}</div>
        <div>${product.price} IQD</div>
      </div>`;
    });
    html += `</div>`;
    return html;
  }

  function scrollToProduct(productId) {
    const card = document.querySelector(`.product-card[data-product-id="${productId}"]`);
    if (card) {
      card.classList.add("highlight");
      card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      setTimeout(() => card.classList.remove("highlight"), 1500);
    }
    document.getElementById("favorites-modal").classList.remove("active");
    document.getElementById("most-sold-modal").classList.remove("active");
  }

  document.getElementById("toggle-sidebar").addEventListener("click", function(e) {
    document.getElementById("sidebar").classList.toggle("expanded");
    e.stopPropagation();
  });

  document.getElementById("menu-home").addEventListener("click", function() {
    this.querySelector("svg").classList.add("animate-home");
    setTimeout(() => this.querySelector("svg").classList.remove("animate-home"), 500);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.getElementById("menu-search").addEventListener("click", function() {
    this.querySelector("svg").classList.add("animate-search");
    setTimeout(() => this.querySelector("svg").classList.remove("animate-search"), 500);
    const searchContainer = document.getElementById("search-bar-container");
    searchContainer.classList.toggle("active");
    if (searchContainer.classList.contains("active")) {
      this.querySelector("svg").innerHTML = '<line x1="18" y1="6" x2="6" y2="18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/><line x1="6" y1="6" x2="18" y2="18" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round"/>';
      document.getElementById("search-bar").focus();
    } else {
      this.querySelector("svg").innerHTML = '<path d="M21 21l-4.35-4.35M10 18a8 8 0 100-16 8 8 0 000 16z" stroke="var(--primary-color)" stroke-width="2" stroke-linecap="round" fill="none"/>';
    }
  });

  document.getElementById("menu-most-sold").addEventListener("click", function() {
    this.querySelector("svg").classList.add("animate-heart");
    setTimeout(() => this.querySelector("svg").classList.remove("animate-heart"), 500);
    openMostSoldModal();
  });

  document.getElementById("menu-favorites").addEventListener("click", function() {
    this.querySelector("svg").classList.add("animate-heart");
    setTimeout(() => this.querySelector("svg").classList.remove("animate-heart"), 500);
    openFavoritesModal();
  });

  document.getElementById("menu-darkmode").addEventListener("click", function() {
    const icon = document.getElementById("darkmode-icon");
    icon.classList.add("toggle-animation");
    setTimeout(() => {
      document.body.classList.toggle("dark-mode");
      if (document.body.classList.contains("dark-mode")) {
        icon.innerHTML = `<circle cx="12" cy="12" r="5" fill="var(--primary-color)"/>
          <g stroke="var(--primary-color)" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="4"/>
            <line x1="12" y1="20" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
            <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="4" y2="12"/>
            <line x1="20" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
            <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
          </g>`;
      } else {
        icon.innerHTML = `<path d="M21 12.79A9 9 0 0111.21 3 7 7 0 1012 21a9 9 0 009-8.21z" fill="var(--primary-color)"/>`;
      }
      icon.classList.remove("toggle-animation");
    }, 500);
  });

  document.getElementById("fab-cart").addEventListener("click", openCartModal);
  document.getElementById("modal-close").addEventListener("click", function() {
    document.getElementById("cart-modal").classList.remove("active");
  });
  document.getElementById("favorites-modal-close").addEventListener("click", function() {
    document.getElementById("favorites-modal").classList.remove("active");
  });
  document.getElementById("most-sold-modal-close").addEventListener("click", function() {
    document.getElementById("most-sold-modal").classList.remove("active");
  });

  function showImageModal(src) {
    const modal = document.getElementById("image-modal");
    document.getElementById("modal-image").src = src;
    modal.classList.add("active");
  }
  document.getElementById("image-modal-close").addEventListener("click", function() {
    document.getElementById("image-modal").classList.remove("active");
  });

  document.getElementById("search-bar").addEventListener("keyup", function() {
    filterProducts(this.value);
  });

  /* وظائف لوحة الإدارة باستخدام Firebase */
  // عرض المنتجات المُضافة في لوحة الإدارة مع تصفية حسب معرف المتجر
  function renderAdminProducts() {
    db.collection("products").where("store", "==", storeId).get().then(querySnapshot => {
      let html = "";
      if(querySnapshot.empty) {
        html = "<p>لا توجد منتجات مضافة.</p>";
      } else {
        querySnapshot.forEach(doc => {
          const product = doc.data();
          product.id = doc.id;
          html += `<div class="product-list-item d-flex justify-content-between align-items-center">
            <div>
              <strong>${product.name}</strong> - ${product.price} IQD
            </div>
            <div>
              <button class="btn btn-sm btn-warning" onclick="editProduct('${product.id}')">تعديل</button>
              <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.id}')">حذف</button>
            </div>
          </div>`;
        });
      }
      document.getElementById("admin-product-list").innerHTML = html;
    }).catch(error => {
      console.error("Error fetching admin products: ", error);
    });
  }

  function editProduct(docId) {
    const product = products.find(p => p.id === docId);
    if (!product) return;
    const newName = prompt("تعديل اسم المنتج:", product.name);
    if(newName === null || newName.trim() === "") return;
    const newDetails = prompt("تعديل تفاصيل المنتج:", product.details || "");
    const newPrice = prompt("تعديل السعر:", product.price);
    if(newPrice === null || isNaN(newPrice)) return;
    const newImage = prompt("تعديل رابط صورة المنتج:", product.image);
    if(newImage === null || newImage.trim() === "") return;
    
    db.collection("products").doc(docId).update({
      name: newName.trim(),
      details: newDetails,
      price: parseFloat(newPrice),
      image: newImage.trim()
    }).then(() => {
      alert("تم تعديل المنتج");
      loadProducts();
      renderAdminProducts();
    }).catch(error => {
      console.error("Error updating product: ", error);
    });
  }

  function deleteProduct(docId) {
    if(confirm("هل أنت متأكد من حذف هذا المنتج؟")) {
      db.collection("products").doc(docId).delete().then(() => {
        alert("تم حذف المنتج");
        loadProducts();
        renderAdminProducts();
      }).catch(error => {
        console.error("Error deleting product: ", error);
      });
    }
  }

  // عند إرسال نموذج إضافة المنتج يتم إضافته إلى Firestore مع تحديد معرف المتجر
  document.getElementById("add-product-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const name = document.getElementById("product-name").value.trim();
    const details = document.getElementById("product-details").value.trim();
    const price = parseFloat(document.getElementById("product-price").value.trim());
    const image = document.getElementById("product-image").value.trim();
    if(name && !isNaN(price) && image){
      const newProduct = {
        name: name,
        details: details,
        price: price,
        quantity: 0,
        image: image,
        store: storeId
      };
      db.collection("products").add(newProduct)
        .then(docRef => {
          alert("تم إضافة المنتج بنجاح");
          loadProducts();
          renderAdminProducts();
          this.reset();
        })
        .catch(error => {
          console.error("Error adding product: ", error);
        });
    } else {
      alert("يرجى التأكد من صحة المدخلات");
    }
  });

  /* زر الدخول للوحة الإدارة عبر الضغط السري (خمس مرات أسفل أيقونة الهامبرجر) */
  let secretClickCount = 0;
  let secretClickTimer = null;
  document.getElementById("sidebar").addEventListener("click", function(e) {
    if(this.classList.contains("expanded")){
      const hamburger = document.getElementById("toggle-sidebar");
      const rect = hamburger.getBoundingClientRect();
      // إذا كان النقر أسفل أيقونة الهامبرجر
      if(e.clientY > rect.bottom) {
        secretClickCount++;
        if(secretClickCount === 5) {
          document.getElementById("admin-modal").classList.add("active");
          secretClickCount = 0;
        }
        if(secretClickTimer) clearTimeout(secretClickTimer);
        secretClickTimer = setTimeout(() => {
          secretClickCount = 0;
        }, 1000);
      }
    }
  });

  // عند تحميل الصفحة
  document.addEventListener("DOMContentLoaded", function() {
    loadProducts();
    renderAdminProducts();
    const memberCountEl = document.getElementById("member-count");
    if(memberCountEl) {
      const count = 9 + 5000;
      memberCountEl.textContent = count;
    }
    const storedOrderCount = localStorage.getItem("orderCount") || "0";
    document.getElementById("order-count").textContent = storedOrderCount;
  });
</script>

  
</body>
</html>
